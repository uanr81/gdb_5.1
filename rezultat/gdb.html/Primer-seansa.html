<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!-- Created by GNU Texinfo 6.7, http://www.gnu.org/software/texinfo/ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=koi8-r">
<title>Пример сеанса (Отладка с помощью GDB)</title>

<meta name="description" content="Пример сеанса (Отладка с помощью GDB)">
<meta name="keywords" content="Пример сеанса (Отладка с помощью GDB)">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="texi2any">
<link href="index.html" rel="start" title="Top">
<link href="Alfavitnyi-ukazatelx.html" rel="index" title="Алфавитный указатель">
<link href="Alfavitnyi-ukazatelx.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="index.html" rel="up" title="Top">
<link href="Vyzov.html" rel="next" title="Вызов">
<link href="Vyrazhenie-priznatelxnosti.html" rel="prev" title="Выражение признательности">
<style type="text/css">
<!--
a.summary-letter {text-decoration: none}
blockquote.indentedblock {margin-right: 0em}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
div.lisp {margin-left: 3.2em}
kbd {font-style: oblique}
pre.display {font-family: inherit}
pre.format {font-family: inherit}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
span.nolinebreak {white-space: nowrap}
span.roman {font-family: initial; font-weight: normal}
span.sansserif {font-family: sans-serif; font-weight: normal}
ul.no-bullet {list-style: none}
-->
</style>


</head>

<body lang="ru">
<span id="g_t_041f_0440_0438_043c_0435_0440-_0441_0435_0430_043d_0441_0430"></span><div class="header">
<p>
Next: <a href="Vyzov.html" accesskey="n" rel="next">Вызов</a>, Previous: <a href="Obzor.html" accesskey="p" rel="prev">Обзор</a>, Up: <a href="index.html" accesskey="u" rel="up">Top</a> &nbsp; [<a href="Alfavitnyi-ukazatelx.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Alfavitnyi-ukazatelx.html" title="Index" rel="index">Index</a>]</p>
</div>
<hr>
<span id="Primer-seansa-GDB"></span><h2 class="chapter">1 Пример сеанса GDB</h2>

<p>Вы можете пользоваться этим руководством в свое удовольствие, чтобы
прочитать о GDB все.  Однако, достаточно небольшого количества
команд, чтобы начать пользоваться отладчиком.  Эта глава иллюстрирует
эти команды.
</p>

<p>В одной из предварительных версий программы <small>GNU</small> <code>m4</code> (настраиваемый
макропроцессор), была допущена следующая ошибка: иногда, при замене
строк, определяющих кавычки, со значений по умолчанию, команды,
использовавшиеся для поиска одного макроопределения внутри другого,
прекращали работать.  В следующем коротком сеансе <code>m4</code> мы
определим макрос <code>foo</code>, который раскрывается в <code>0000</code>; затем мы
используем встроенную процедуру <code>m4</code> <code>defn</code>, чтобы определить
точно такой же макрос <code>bar</code>.  Однако, если мы изменим открывающую кавычку
на <code>&lt;QUOTE&gt;</code>, а закрывающую на <code>&lt;UNQUOTE&gt;</code>, та же самая процедура не
сможет определить новый синоним <code>baz</code>:
</p>
<div class="example">
<pre class="example">$ <b>cd gnu/m4</b>
$ <b>./m4</b>
<b>define(foo,0000)</b>

<b>foo</b>
0000
<b>define(bar,defn(&lsquo;foo&rsquo;))</b>

<b>bar</b>
0000
<b>changequote(&lt;QUOTE&gt;,&lt;UNQUOTE&gt;)</b>

<b>define(baz,defn(&lt;QUOTE&gt;foo&lt;UNQUOTE&gt;))</b>
<b>baz</b>
<b>C-d</b>
m4: End of input: 0: fatal error: EOF in string<a id="DOCF2" href="#FOOT2">(2)</a>
</pre></div>

<p>Попытаемся с помощью GDB понять, что же происходит.
</p>
<div class="example">
<pre class="example">$ <b>gdb m4</b>
GDB is free software and you are welcome to distribute copies
 of it under certain conditions; type &quot;show copying&quot; to see
 the conditions.
There is absolutely no warranty for GDB; type &quot;show warranty&quot;
 for details.

GDB 5.0, Copyright 1999 Free Software Foundation, Inc...
(gdb)
</pre></div>

<p>GDB читает только минимум символьных данных, достаточный для того,
чтобы знать, где в случае
необходимости искать остальные; в результате первое приглашение
появляется очень быстро.  Теперь мы велим GDB использовать меньшую
чем обычно ширину экрана, чтобы примеры умещались на
страницах этого руководства.
</p>
<div class="example">
<pre class="example">(gdb) <b>set width 70</b>
</pre></div>

<p>Нам необходимо увидеть, как работает встроенная процедура <code>m4</code>
<code>changequote</code>.  Посмотрев исходный текст, мы знаем, что
соответствующей подпрограммой является <code>m4_changequote</code>, так что мы
устанавливаем на ней точку останова с помощью команды GDB <code>break</code>.
</p>
<div class="example">
<pre class="example">(gdb) <b>break m4_changequote</b>
Breakpoint 1 at 0x62f4: file builtin.c, line 879.
</pre></div>

<p>Используя команду <code>run</code>, мы запускаем <code>m4</code> под управлением
GDB; до тех пор, пока управление не достигло подпрограммы
<code>m4_changequote</code>, программа выполняется как обычно:
</p>
<div class="example">
<pre class="example">(gdb) <b>run</b>
Starting program: /work/Editorial/gdb/gnu/m4/m4
<b>define(foo,0000)</b>

<b>foo</b>
0000
</pre></div>

<p>Чтобы активировать точку останова, мы вызываем <code>changequote</code>.
GDB приостанавливает выполнение <code>m4</code>, выводя на экран
информацию о том месте, где он остановился.
</p>
<div class="example">
<pre class="example"><b>changequote(&lt;QUOTE&gt;,&lt;UNQUOTE&gt;)</b>

Breakpoint 1, m4_changequote (argc=3, argv=0x33c70)
    at builtin.c:879
879         if (bad_argc(TOKEN_DATA_TEXT(argv[0]),argc,1,3))
</pre></div>

<p>Теперь мы используем команду <code>n</code> (<code>next</code>), чтобы продолжить
выполнение до следующей строки текущей функции.
</p>
<div class="example">
<pre class="example">(gdb) <b>n</b>
882         set_quotes((argc &gt;= 2) ? TOKEN_DATA_TEXT(argv[1])\
 : nil,
</pre></div>

<p><code>set_quotes</code> выглядит как нужная нам подпрограмма.  Мы можем войти в
нее, используя команду <code>s</code> (<code>step</code>) вместо <code>next</code>.
<code>step</code> переходит на следующую исполняемую строку <em>любой</em>
подпрограммы, так что она входит в <code>set_quotes</code>.
</p>
<div class="example">
<pre class="example">(gdb) <b>s</b>
set_quotes (lq=0x34c78 &quot;&lt;QUOTE&gt;&quot;, rq=0x34c88 &quot;&lt;UNQUOTE&gt;&quot;)
    at input.c:530
530         if (lquote != def_lquote)
</pre></div>

<p>Отображение, показывающее подпрограмму (и ее параметры), где <code>m4</code>
сейчас приостановлен, называется отображением кадра стека.  Оно
показывает обзор стека.  Мы можем использовать команду
<code>backtrace</code> (которую можно сокращать как <code>bt</code>), чтобы посмотреть, в
каком месте стека мы находимся: команда <code>backtrace</code> выводит
кадр стека для каждой активной подпрограммы.
</p>
<div class="example">
<pre class="example">(gdb) <b>bt</b>
#0  set_quotes (lq=0x34c78 &quot;&lt;QUOTE&gt;&quot;, rq=0x34c88 &quot;&lt;UNQUOTE&gt;&quot;)
    at input.c:530
#1  0x6344 in m4_changequote (argc=3, argv=0x33c70)
    at builtin.c:882
#2  0x8174 in expand_macro (sym=0x33320) at macro.c:242
#3  0x7a88 in expand_token (obs=0x0, t=209696, td=0xf7fffa30)
    at macro.c:71
#4  0x79dc in expand_input () at macro.c:40
#5  0x2930 in main (argc=0, argv=0xf7fffb20) at m4.c:195
</pre></div>

<p>Пройдем по шагам еще несколько строк, чтобы понять, что же происходит.
Первые два раза мы можем использовать &lsquo;<samp>s</samp>&rsquo;; следующие два раза
мы пользуемся командой <code>n</code>, чтобы избежать
вхождения в подпрограмму <code>xstrdup</code>.
</p>
<div class="example">
<pre class="example">(gdb) <b>s</b>
0x3b5c  532         if (rquote != def_rquote)
(gdb) <b>s</b>
0x3b80  535         lquote = (lq == nil || *lq == '\0') ?  \
def_lquote : xstrdup(lq);
(gdb) <b>n</b>
536         rquote = (rq == nil || *rq == '\0') ? def_rquote\
 : xstrdup(rq);
(gdb) <b>n</b>
538         len_lquote = strlen(rquote);
</pre></div>

<p>Последняя выведенная строка выглядит несколько странно; мы можем
исследовать переменные <code>lquote</code> и <code>rquote</code>, чтобы понять,
действительно ли это определенные нами новые левая и правая кавычки.
Мы используем команду <code>p</code> (<code>print</code>), чтобы посмотреть их значения.
</p>
<div class="example">
<pre class="example">(gdb) <b>p lquote</b>
$1 = 0x35d40 &quot;&lt;QUOTE&gt;&quot;
(gdb) <b>p rquote</b>
$2 = 0x35d50 &quot;&lt;UNQUOTE&gt;&quot;
</pre></div>

<p>Действительно, <code>lquote</code> и <code>rquote</code> являются новыми кавычками.  Для
просмотра контекста, мы можем вывести десять строк исходного текста,
окружающих текущую строку, используя команду <code>l</code> (<code>list</code>).
</p>
<div class="example">
<pre class="example">(gdb) <b>l</b>
533             xfree(rquote);
534
535         lquote = (lq == nil || *lq == '\0') ? def_lquote\
 : xstrdup (lq);
536         rquote = (rq == nil || *rq == '\0') ? def_rquote\
 : xstrdup (rq);
537
538         len_lquote = strlen(rquote);
539         len_rquote = strlen(lquote);
540     }
541
542     void
</pre></div>

<p>Давайте пройдем еще две строки, которые устанавливают <code>len_lquote</code> и
<code>len_rquote</code>, и затем исследуем значения этих переменных.
</p>
<div class="example">
<pre class="example">(gdb) <b>n</b>
539         len_rquote = strlen(lquote);
(gdb) <b>n</b>
540     }
(gdb) <b>p len_lquote</b>
$3 = 9
(gdb) <b>p len_rquote</b>
$4 = 7
</pre></div>

<p>Это, очевидно, неправильно, так как <code>len_lquote</code> и <code>len_rquote</code>
обозначают длины переменных <code>lquote</code> и <code>rquote</code> соответственно.
Мы можем присвоить им лучшие значения, используя
команду <code>p</code>, так как она может выводить значение любого выражения, а
выражение может содержать вызовы подпрограмм и присваивания.
</p>
<div class="example">
<pre class="example">(gdb) <b>p len_lquote=strlen(lquote)</b>
$5 = 7
(gdb) <b>p len_rquote=strlen(rquote)</b>
$6 = 9
</pre></div>

<p>Достаточно ли этого, чтобы решить проблему использования новых кавычек
во встроенной процедуре <code>m4</code> <code>defn</code>?  Мы можем
продолжить выполнение <code>m4</code> командой <code>c</code> (<code>continue</code>),
и затем попробовать пример, первоначально вызывавший ошибку:
</p>
<div class="example">
<pre class="example">(gdb) <b>c</b>
Continuing.

<b>define(baz,defn(&lt;QUOTE&gt;foo&lt;UNQUOTE&gt;))</b>

baz
0000
</pre></div>

<p>Получилось!  Теперь новые кавычки работают так же хорошо, как и стандартные.
Кажется, проблема заключалась лишь в двух опечатках, приводивших к
неправильному определению длин.  Мы позволим <code>m4</code> выйти, подавая ему
на вход EOF:
</p>
<div class="example">
<pre class="example"><b>C-d</b>
Program exited normally.<a id="DOCF3" href="#FOOT3">(3)</a>
</pre></div>

<p>Сообщение &lsquo;<samp>Program exited normally.</samp>&rsquo;
исходит от GDB; оно
показывает, что <code>m4</code> закончила выполнение.  Мы можем завершить наш
сеанс работы с GDB командой <code>quit</code>.
</p>
<div class="example">
<pre class="example">(gdb) <b>quit</b>
</pre></div>

<div class="footnote">
<hr>
<h4 class="footnotes-heading">Footnotes</h4>

<h5><a id="FOOT2" href="#DOCF2">(2)</a></h3>
<p>m4: Конец ввода: 0: фатальная ошибка: EOF в строке  <i>(Прим. переводчика)</i></p>
<h5><a id="FOOT3" href="#DOCF3">(3)</a></h3>
<p>Программа завершилась нормально.  <i>(Прим. переводчика)</i></p>
</div>
<hr>
<div class="header">
<p>
Next: <a href="Vyzov.html" accesskey="n" rel="next">Вызов</a>, Previous: <a href="Obzor.html" accesskey="p" rel="prev">Обзор</a>, Up: <a href="index.html" accesskey="u" rel="up">Top</a> &nbsp; [<a href="Alfavitnyi-ukazatelx.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Alfavitnyi-ukazatelx.html" title="Index" rel="index">Index</a>]</p>
</div>



</body>
</html>
